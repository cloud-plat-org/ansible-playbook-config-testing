


```bash
# AWX Job Execution Test Script
# Usage: source ~/awx-venv/bin/activate && ./docs/07.2-Execution-Job-Test.md

# Activate AWX virtual environment
source ~/awx-venv/bin/activate

# Extract stored OAuth2 token
export AWX_TOKEN=$(kubectl get secret awx-admin-password -n awx -o jsonpath='{.data.password}' | base64 -d)

# AWX Configuration Parameters
export JOB_TEMPLATE_NAME="WSL Service Management"
export PROJECT_NAME="WSL Automation"
export HOST_GROUP="all_servers"  # Changed from wsl_instances to all_servers

# Service Configuration Variables
export SERVICE_NAME="cron"
export SERVICE_STATE="stopped"
export DEBUG_EXTRA=false

# Extra Variables JSON
export EXTRA_VARS="{\"service_name\": \"$SERVICE_NAME\", \"service_state\": \"$SERVICE_STATE\", \"debug_extra\": $DEBUG_EXTRA}"
```

### 0. Diagnostic Commands (Run First)
```bash
# Check inventory and hosts
echo "=== Inventory Information ==="
INVENTORY_ID=$(awx --conf.host https://localhost -k --conf.token "$AWX_TOKEN" inventory list --name "WSL Lab" --format json | jq -r '.results[0].id')
echo "Inventory ID: $INVENTORY_ID"

echo "=== Hosts in Inventory ==="
awx --conf.host https://localhost -k --conf.token "$AWX_TOKEN" hosts list --inventory "$INVENTORY_ID" --format json | jq '.results[] | {name, inventory, variables}'

echo "=== Groups in Inventory ==="
awx --conf.host https://localhost -k --conf.token "$AWX_TOKEN" groups list --inventory "$INVENTORY_ID" --format json | jq '.results[] | {name, inventory}'

echo "=== Job Template Configuration ==="
JOB_TEMPLATE_ID=$(awx --conf.host https://localhost -k --conf.token "$AWX_TOKEN" job_templates list --name "$JOB_TEMPLATE_NAME" --format json | jq -r '.results[0].id')
awx --conf.host https://localhost -k --conf.token "$AWX_TOKEN" job_templates get "$JOB_TEMPLATE_ID" --format json | jq '{name, inventory, playbook, ask_inventory_on_launch}'
```

### 1. Launch Job with Extra Variables
```bash
# Launch service lifecycle test
JOB_ID=$(awx --conf.host https://localhost -k --conf.token "$AWX_TOKEN" job_templates launch \
  --job_template "$JOB_TEMPLATE_NAME" \
  --extra_vars "$EXTRA_VARS" | jq -r .id)

echo "Job ID: $JOB_ID"
```

### 2. Monitor Job Execution
```bash
# Check job status
awx --conf.host https://localhost -k --conf.token "$AWX_TOKEN" job get "$JOB_ID" | jq '{id, status, started, finished}'

# Get job output
awx --conf.host https://localhost -k --conf.token "$AWX_TOKEN" job stdout "$JOB_ID"
```

### 3. Launch with Host Limit
```bash
# Launch with specific host limit
JOB_ID=$(awx --conf.host https://localhost -k --conf.token "$AWX_TOKEN" job_templates launch \
  --job_template "$JOB_TEMPLATE_NAME" \
  --limit "$HOST_GROUP" \
  --extra_vars "$EXTRA_VARS" | jq -r .id)

echo "Job ID: $JOB_ID"
```

### 4. Launch with Explicit Inventory (Alternative)
```bash
# If the job template doesn't have the correct inventory set, specify it explicitly
JOB_ID=$(awx --conf.host https://localhost -k --conf.token "$AWX_TOKEN" job_templates launch \
  --job_template "$JOB_TEMPLATE_NAME" \
  --inventory "$INVENTORY_ID" \
  --limit "$HOST_GROUP" \
  --extra_vars "$EXTRA_VARS" | jq -r .id)

echo "Job ID: $JOB_ID"
```

### 5. Update Project
```bash
# Update the project to pull the latest changes from your repository
PROJECT_ID=$(awx --conf.host https://localhost -k --conf.token "$AWX_TOKEN" projects list --name "$PROJECT_NAME" --format json | jq -r '.results[0].id')
awx --conf.host https://localhost -k --conf.token "$AWX_TOKEN" projects update "$PROJECT_ID" --scm_update_revision
```