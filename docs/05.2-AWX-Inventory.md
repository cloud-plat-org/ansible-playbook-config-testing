
# AWX Inventory Management

This guide covers how to interact with your AWX "WSL Lab" inventory and extract host information.

## Prerequisites

Set up your AWX environment variables:
```bash
# Extract stored OAuth2 token
export AWX_TOKEN=$(kubectl get secret awx-admin-password -n awx -o jsonpath='{.data.password}' | base64 -d)
export inventory_name="WSL Lab"
```

## 1. Get Inventory Information

### Get Inventory ID
```bash
# Get the inventory ID for the "WSL Lab" inventory
Inventory_id=$(awx --conf.host https://localhost -k --conf.token "$AWX_TOKEN" inventory list --name "$inventory_name" --format json | jq -r '.results[0].id')

echo "Inventory ID: $Inventory_id"
```

## 2. List Hosts in Inventory

### Quick Host Summary
```bash
# Get basic host information
host_json=$(awx --conf.host https://localhost -k --conf.token "$AWX_TOKEN" host list --inventory "$inventory_name" --format json)

echo "=== Host Summary for '$inventory_name' ==="
echo "$host_json" | jq -r '.results[] | "Host: \(.name), Last Job: \(.last_job // "None")"'
```

### Detailed Host Information
```bash
# Get detailed host information with variables
echo "$host_json" | jq -r '.results[] | 
  "Host: " + .name + "\n" +
  "  Last Job: " + (.last_job | tostring) + "\n" +
  "  Variables: " + (.variables | tostring) + "\n"'
```

### Current WSL Lab Hosts
Based on your AWX inventory, you have these hosts:
- **argo_cd_mgt**: `172.22.192.129:2226`
- **ubuntuAWX**: `172.22.192.129:2225`
- **wslkali1**: `172.22.192.129:2224`
- **wslubuntu1**: `172.22.192.129:2223`

## 3. Export Inventory to YAML

### Simple Export (Basic Format)
```bash
# Export hosts to basic YAML format
awx --conf.host https://localhost -k --conf.token "$AWX_TOKEN" host list --inventory "$inventory_name" --format json | \
jq -r '.results[] | "- name: \(.name)\n  ansible_host: \(.variables | fromjson | .ansible_host)\n  ansible_port: \(.variables | fromjson | .ansible_port)\n  ansible_user: daniv"' > inventory/wsl_instances_actual.yml
```

### Complete Ansible Inventory Export
```bash
# Generate complete Ansible inventory structure
cat > inventory/wsl_instances_actual.yml << 'EOF'
---
all:
  children:
    wsl_instances:
      hosts:
EOF

# Add each host with proper indentation and variables
awx --conf.host https://localhost -k --conf.token "$AWX_TOKEN" host list --inventory "$inventory_name" --format json | \
jq -r '.results[] | "        \(.name):\n          ansible_host: \(.variables | fromjson | .ansible_host)\n          ansible_port: \(.variables | fromjson | .ansible_port)\n          ansible_user: daniv"' >> inventory/wsl_instances_actual.yml

# Add common variables and groups
cat >> inventory/wsl_instances_actual.yml << 'EOF'
      vars:
        ansible_ssh_common_args: '-o StrictHostKeyChecking=no'
        ansible_python_interpreter: /usr/bin/python3
        awx_user: daniv
        sudoers_type: "systemctl"
        
    service_test_hosts:
      hosts:
EOF

# Add all hosts to service_test_hosts group
awx --conf.host https://localhost -k --conf.token "$AWX_TOKEN" host list --inventory "$inventory_name" --format json | \
jq -r '.results[] | "        \(.name):"' >> inventory/wsl_instances_actual.yml

# Add service test variables
cat >> inventory/wsl_instances_actual.yml << 'EOF'
      vars:
        service_mgmt_service_name: cron
        service_mgmt_service_state: stopped
EOF

echo "Inventory exported to inventory/wsl_instances_actual.yml"
```

## 4. Key Points

### WSL Instance Configuration
- **Same IP**: All WSL instances share `172.22.192.129`
- **Different Ports**: Each instance uses unique SSH ports (2223-2226)
- **Same User**: All instances use `daniv` as the SSH user

### Variable Extraction
- Host variables are stored as JSON strings in the `variables` field
- Use `.variables | fromjson | .ansible_host` to extract connection details
- The `last_job` field shows the most recent job run on each host

### Usage
- Use AWX for active management and job execution
- Use exported YAML for documentation and backup
- Update YAML when adding new WSL instances


